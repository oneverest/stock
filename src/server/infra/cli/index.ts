import program from 'commander';
import { createPovUseCase } from 'modules/pov/useCases/createPov';
import { CreatePovDTO } from 'modules/pov/useCases/createPov/createPovDTO';
import { RequestOptions, get } from 'http';

require('dotenv').config();

async function run(arg: string, arg2: any) {
  console.log(arg, arg2);
  const datas = [
    ['2019-03-21', 1, 0],
    ['2019-03-22', 0.7014697, 0.566645518],
    ['2019-03-25', 0.946817127, 0.973462584],
    ['2019-03-26', 0.911561818, 0.999891669],
    ['2019-03-27', 0.907554669, 0.999890754],
    ['2019-03-28', 0.898117109, 0.999890754],
    ['2019-03-29', 0.92184827, 0.999890754],
    ['2019-04-01', 0.976636215, 0.972427197],
    ['2019-04-02', 0.983705203, 0.972084072],
    ['2019-04-03', 1.000294474, 0.747780038],
    ['2019-04-04', 1.016766187, 0.746028965],
    ['2019-04-08', 1.013594859, 0.743038732],
    ['2019-04-09', 1.009118653, 0.971155201],
    ['2019-04-10', 1.010466982, 0.869446634],
    ['2019-04-11', 0.99055843, 0.972456953],
    ['2019-04-12', 0.992031104, 0.972454513],
    ['2019-04-15', 0.985552314, 0.972454513],
    ['2019-04-16', 0.998305189, 0.93041287],
    ['2019-04-17', 0.994973615, 0.888368513],
    ['2019-04-18', 0.996885666, 0.971516507],
    ['2019-04-19', 0.996094119, 0.971197753],
    ['2019-04-22', 1.010999301, 0.971019311],
    ['2019-04-23', 0.981299665, 0.974392059],
    ['2019-04-24', 0.971195291, 0.974392059],
    ['2019-04-25', 0.940565801, 0.974389283],
    ['2019-04-26', 0.932746775, 0.974389283],
    ['2019-04-29', 0.916006982, 0.974389283],
    ['2019-04-30', 0.926600479, 0.972096304],
    ['2019-05-06', 0.870454738, 0.972096304],
    ['2019-05-07', 0.877757584, 0.972096304],
    ['2019-05-08', 0.874709066, 0.972096304],
    ['2019-05-09', 0.868428868, 0.972096304],
    ['2019-05-10', 0.894280913, 0.972096304],
    ['2019-05-13', 0.885056266, 0.972096304],
    ['2019-05-14', 0.880800552, 0.972096304],
    ['2019-05-15', 0.890709277, 0.972096304],
    ['2019-05-16', 0.904560123, 0.972096304],
    ['2019-05-17', 0.904560123, 0.972096304],
    ['2019-05-20', 0.887237546, 0.972096304],
    ['2019-05-21', 0.895051021, 0.972096304],
    ['2019-05-22', 0.892256431, 0.972096304],
    ['2019-05-23', 0.886156009, 0.971491318],
    ['2019-05-24', 0.87752941, 0.971491318],
    ['2019-05-27', 0.892128163, 0.971491318],
    ['2019-05-28', 0.89039646, 0.971491318],
    ['2019-05-29', 0.887718426, 0.971491318],
    ['2019-05-30', 0.886171272, 0.971491318],
    ['2019-05-31', 0.890334574, 0.971490763],
    ['2019-06-03', 0.885457222, 0.971490763],
    ['2019-06-04', 0.873010609, 0.971490763],
    ['2019-06-05', 0.874059622, 0.971490763],
    ['2019-06-06', 0.865908964, 0.971490763],
    ['2019-06-10', 0.872128107, 0.971490763],
    ['2019-06-11', 0.873146593, 0.971490763],
    ['2019-06-12', 0.870418606, 0.971490763],
    ['2019-06-13', 0.873505976, 0.971490763],
    ['2019-06-14', 0.864506118, 0.971490763],
    ['2019-06-17', 0.852786598, 0.981170537],
    ['2019-06-18', 0.855034481, 0.981170537],
    ['2019-06-19', 0.863423804, 0.981170537],
    ['2019-06-20', 0.879115971, 0.981170537],
    ['2019-06-21', 0.886060821, 0.981158048],
    ['2019-06-24', 0.887426201, 0.981158048],
    ['2019-06-25', 0.90223971, 0.96344588],
    ['2019-06-26', 0.918753327, 0.96344588],
    ['2019-06-27', 0.897656845, 0.97208326],
    ['2019-06-28', 0.895599061, 0.97208326],
    ['2019-07-01', 0.90461557, 0.97208326],
    ['2019-07-02', 0.89992693, 0.97208326],
    ['2019-07-03', 0.893786878, 0.97208326],
    ['2019-07-04', 0.891705505, 0.97208326],
    ['2019-07-05', 0.897117076, 0.97208326],
    ['2019-07-08', 0.919318392, 0.97208326],
    ['2019-07-09', 0.919318392, 0.97208326],
    ['2019-07-10', 0.895729494, 0.97208326],
    ['2019-07-11', 0.892954329, 0.97208326],
    ['2019-07-12', 0.891566747, 0.97208326],
    ['2019-07-15', 0.909731197, 0.972623066],
    ['2019-07-16', 0.915704897, 0.972623066],
    ['2019-07-17', 0.910506826, 0.972623066],
    ['2019-07-18', 0.903956167, 0.972623066],
    ['2019-07-19', 0.916111761, 0.972623066],
    ['2019-07-22', 0.903268988, 0.972623066],
    ['2019-07-23', 0.911521579, 0.972623066],
    ['2019-07-24', 0.927099463, 0.972623066],
    ['2019-07-25', 0.935276219, 0.972623066],
    ['2019-07-26', 0.94275491, 0.972623066],
    ['2019-07-29', 0.945166161, 0.972623066],
    ['2019-07-30', 0.957698683, 0.972623066],
    ['2019-07-31', 0.959771108, 0.972623066],
    ['2019-08-01', 0.957428033, 0.893933171],
    ['2019-08-02', 0.935140687, 0.908347376],
    ['2019-08-05', 0.919127988, 0.983405862],
    ['2019-08-06', 0.915132542, 0.979465725],
    ['2019-08-07', 0.897971521, 0.989551464],
    ['2019-08-08', 0.906124955, 0.989551464],
    ['2019-08-09', 0.902696239, 0.989551464],
    ['2019-08-12', 0.918990298, 0.979470998],
    ['2019-08-13', 0.922657678, 0.979470998],
    ['2019-08-14', 0.926542908, 0.979470998],
    ['2019-08-15', 0.919643849, 0.979470998],
    ['2019-08-16', 0.921479621, 0.979470998],
    ['2019-08-19', 0.952063848, 0.965588599],
    ['2019-08-20', 0.9558908, 0.965588599],
    ['2019-08-21', 0.997479776, 0.96566178],
    ['2019-08-22', 0.993435695, 0.749271769],
    ['2019-08-23', 0.97895941, 0.95888301],
    ['2019-08-26', 0.98397058, 0.96794266],
    ['2019-08-27', 1.00330067, 0.966942532],
    ['2019-08-28', 0.99658355, 0.966645423],
    ['2019-08-29', 0.998092407, 0.966644868],
    ['2019-08-30', 1.013279495, 0.966644868],
    ['2019-09-02', 1.022366494, 0.966644868],
    ['2019-09-03', 1.012746525, 0.965200256],
    ['2019-09-04', 1.014580909, 0.965200256],
    ['2019-09-05', 1.015306614, 0.965200256],
    ['2019-09-06', 1.012331638, 0.965200256],
    ['2019-09-09', 1.024545137, 0.965200256],
    ['2019-09-10', 1.031861858, 0.965200256],
    ['2019-09-11', 1.024761599, 0.965200256],
    ['2019-09-16', 1.052130646, 0.965200256],
    ['2019-09-17', 1.015932788, 0.965200256],
    ['2019-09-18', 1.010940267, 0.965200256],
    ['2019-09-23', 0.998027427, 0.965200256],
    ['2019-09-25', 0.976356868, 0.98248229],
    ['2019-09-26', 0.951260735, 0.98248229],
    ['2019-10-09', 0.960771109, 0.98248229],
    ['2019-10-10', 0.969776458, 0.98248229],
    ['2019-10-11', 0.982963346, 0.982800932],
    ['2019-10-14', 1.005364495, 0.966208362],
    ['2019-10-15', 1.006269938, 0.966208362],
    ['2019-10-16', 0.992350264, 0.966321806],
    ['2019-10-17', 0.981022952, 0.888503877],
    ['2019-10-18', 0.967989131, 0.888503877],
    ['2019-10-21', 0.961727364, 0.888503877],
    ['2019-10-22', 0.976130905, 0.888503877],
    ['2019-10-23', 0.966603297, 0.888503877],
    ['2019-10-24', 0.968366475, 0.888503877],
    ['2019-10-25', 0.97413944, 0.888503877],
    ['2019-10-28', 0.982650501, 0.888503877],
    ['2019-10-29', 0.975783104, 0.888503877],
    ['2019-10-30', 0.961449392, 0.888503877],
    ['2019-10-31', 0.954559165, 0.888503877],
    ['2019-11-01', 0.956764037, 0.890141404],
    ['2019-11-04', 0.962480001, 0.890141404],
    ['2019-11-05', 0.97071787, 0.890141404],
    ['2019-11-06', 0.97399661, 0.890141404],
    ['2019-11-07', 0.956943984, 0.890141404],
    ['2019-11-08', 0.960950451, 0.890141404],
    ['2019-11-11', 0.94892311, 0.890141404],
    ['2019-11-13', 0.946073066, 0.890141404],
    ['2019-11-14', 0.94937827, 0.890141404],
    ['2019-11-15', 0.94885166, 0.890141404],
    ['2019-11-18', 0.952541299, 0.890849071],
    ['2019-11-19', 0.959057854, 0.890849071],
    ['2019-11-20', 0.962587018, 0.90572183],
    ['2019-11-21', 0.96323084, 0.90572183],
    ['2019-11-22', 0.959103339, 0.90572183],
    ['2019-11-25', 0.967186883, 0.90572183],
    ['2019-11-26', 0.969779056, 0.948595179],
    ['2019-11-27', 0.964904309, 0.874680878],
    ['2019-11-28', 0.950023854, 0.999693913],
    ['2019-11-29', 0.952032788, 0.999693913],
    ['2019-12-02', 0.956725155, 0.885526747],
    ['2019-12-03', 0.956745339, 0.999352341],
    ['2019-12-04', 0.955695691, 0.999352341],
    ['2019-12-05', 0.962120716, 0.999613005],
    ['2019-12-06', 0.968930101, 0.999658875],
    ['2019-12-09', 0.969580823, 0.999658875],
    ['2019-12-10', 0.968898099, 0.999658875],
    ['2019-12-11', 0.971131178, 0.999658875],
    ['2019-12-12', 0.967049052, 0.999658875],
    ['2019-12-13', 0.97714058, 0.999658875],
    ['2019-12-16', 0.981751344, 0.999658875],
    ['2019-12-17', 0.994918452, 0.773109409],
    ['2019-12-18', 0.99055692, 1],
    ['2019-12-19', 0.991288161, 1],
    ['2019-12-20', 0.986567225, 1],
    ['2019-12-23', 0.97647004, 0.999777071],
    ['2019-12-24', 0.981329713, 0.999777071],
    ['2019-12-25', 0.980992286, 0.99859022],
    ['2019-12-26', 0.983838159, 0.99859022],
    ['2019-12-27', 0.985815216, 0.99859022],
    ['2019-12-30', 0.992444523, 0.99859022],
    ['2019-12-31', 0.997847058, 0.99859022],
    ['2020-01-02', 1.009524582, 0.769369985],
    ['2020-01-03', 1.016775606, 0.931798625],
    ['2020-01-06', 1.023621343, 0.486473696],
    ['2020-01-07', 1.031421587, 0.908688391],
    ['2020-01-08', 1.028255692, 0.847144152],
    ['2020-01-09', 1.028397279, 0.998450415],
    ['2020-01-10', 1.024274424, 0.998450415],
    ['2020-01-13', 1.031655212, 0.998450415],
    ['2020-01-14', 1.025449355, 0.999938821],
    ['2020-01-15', 1.010283716, 0.991151902],
    ['2020-01-16', 1.012774824, 0.973801434],
    ['2020-01-17', 1.011724441, 0.999590905],
    ['2020-01-20', 1.016280549, 0.999590656],
    ['2020-01-21', 1.001468413, 0.999590656],
    ['2020-01-22', 0.994479282, 0.999590656],
    ['2020-01-23', 0.975856161, 0.999635904],
    ['2020-02-03', 0.931329722, 0.817390672],
    ['2020-02-04', 0.923040655, 0.817390672],
    ['2020-02-05', 0.928940972, 0.890788802],
    ['2020-02-06', 0.943095563, 0.890788802],
    ['2020-02-07', 0.933711775, 0.800694999],
    ['2020-02-10', 0.941304314, 0.809427476],
    ['2020-02-11', 0.948058175, 0.997256629],
    ['2020-02-12', 0.954831261, 0.997256629],
    ['2020-02-13', 0.945126035, 0.997256629],
    ['2020-02-14', 0.946462586, 0.998043469],
    ['2020-02-17', 0.973031209, 0.996597397],
    ['2020-02-18', 0.980178943, 0.99659286],
    ['2020-02-19', 0.973347651, 0.99659286],
    ['2020-02-20', 0.984390231, 0.99659286],
    ['2020-02-21', 0.983724455, 0.99659286],
    ['2020-02-24', 0.975609247, 0.99659286],
    ['2020-02-25', 0.970863543, 0.999692911],
    ['2020-02-26', 0.97464945, 0.99937003],
    ['2020-02-27', 0.969756823, 0.99937003],
    ['2020-02-28', 0.943589809, 0.99937003],
    ['2020-03-02', 0.9694307, 0.999370088],
    ['2020-03-03', 0.974505453, 0.999999338],
    ['2020-03-04', 0.97779155, 0.715593255],
    ['2020-03-05', 0.98819966, 0.999027207],
    ['2020-03-06', 0.987410256, 0.999027207],
    ['2020-03-09', 0.990774552, 0.999028309],
    ['2020-03-10', 0.988960988, 0.999429157],
    ['2020-03-11', 0.988324658, 0.831462518],
    ['2020-03-12', 0.969298922, 0.999755432],
    ['2020-03-13', 0.953909611, 0.998848421],
    ['2020-03-16', 0.950085468, 0.99802821],
    ['2020-03-17', 0.94889002, 0.999597565],
    ['2020-03-18', 0.935985943, 0.968755201],
    ['2020-03-19', 0.923672757, 0.995870299],
    ['2020-03-20', 0.940497108, 0.905920304],
    ['2020-03-23', 0.918684645, 0.906452706],
    ['2020-03-24', 0.934635119, 0.906083491],
    ['2020-03-25', 0.943789984, 0.906043368],
    ['2020-03-26', 0.935035898, 0.911657838],
    ['2020-03-26', 0.944021813, 0.905910245],
  ];

  const dto = {} as CreatePovDTO;
  let counter = 0;
  console.log(`Total ${datas.length} rows`);
  for (const data of datas) {
    dto.net_worth = Number(data[1]);
    dto.position_ratio = Number(data[2]);
    dto.record_date = String(data[0]);
    dto.szzs = 2000;
    const resultOrError = await createPovUseCase.execute(dto);
    if (resultOrError.isLeft()) {
      console.log(resultOrError.value);
    } else {
      console.log(`插入成功 ${++counter}`);
    }
  }
  return;
}

async function szzs() {
  const response: any = await new Promise((resolve, reject) => {
    const options: RequestOptions = {
      host: 'web.ifzq.gtimg.cn',
      path: '/appstock/app/fqkline/get?param=sh000001,day,2019-03-22,,640,qfq',
      method: 'GET',
    };
    get(options, res => {
      let msg = '';
      res.on('data', chunk => (msg += chunk));
      res.on('end', () => {
        console.log(JSON.parse(msg));
        resolve(JSON.parse(msg));
      });
    }).on('error', err => {
      console.log('Error:', err.message);
      reject(err);
    });
  });

  const dataSet = response.data.sh000001.day as string[][];
  for (const data of dataSet) {
    console.log(`update pov set szzs=${data[2]} where record_date='${data[0]}';`);
  }
}

async function main() {
  program
    .version('0.1.0')
    .command('import <file>')
    .action(run);

  program.command('szzs').action(szzs);

  await program.parseAsync(process.argv);
}

main();
